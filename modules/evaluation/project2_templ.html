<style>
    .panel-body ul {
        padding: 0px;
        text-align: center;
    }
.textarea{
    /*resize: none;*/
    text-align: left;
    max-width:90%;
    min-width:90%;
}
    .red {
        color: red;
    }
    .heard{
        font-size: 18px;
        font-weight: bolder;
        padding: 5px;
    }
    .row-cell{
        display: flex;
    }
    .cell{
        display: flex;
        align-items: stretch;
        justify-content:center;
        border: 1px solid #ddd;
        padding: 5px;
    }
    .cell .npmal{
        display: flex;
        align-items: center;
    }
    .scaleMark{
        display: flex;
        flex-direction: column;
        align-items: baseline;
    }
    .scaleMark div{
        text-align: left;
    }
    .col-sm-10{
        padding: 0;
        border: 0;
    }
</style>
<ul id="head" class="list-group row" style="margin-bottom: 0px;">
    <li class="list-group-item col-sm-12" style="font-size: 18px;">
        <div class="col-sm-1" style="text-align: right;padding: 0;">
            <span class="form-control" style="border: 0;padding-left: 0;">年份：</span>
        </div>
        <div class="col-sm-1" style="padding: 0;">
            <select class="form-control">
                <option>2018</option>
                <option>2019</option>
            </select>
        </div>
        <div class="col-sm-4">
            <b>自治水利建设质量考核</b>
        </div>
        <div class="col-sm-6"><b>总得分：<span id="sumSpan" class="red">0</span> 分</b></div>
        <input id="sum" type="hidden">
    </li>
</ul>
<ul id="center" class="list-group row" style="overflow: auto;margin-bottom: 0px;">
    <% for(var i = 0; i < evaluations.length; i++) { %>
    <% var evaluation = evaluations[i] %>
    <li class="list-group-item col-sm-12">
            <div class="group">
                <div style="background-color: #f3f3f3;">
                    <div class="col-sm-6"><h4 class="box-title" style="text-align: left; padding-left: 35px;"><b><%=evaluation.evaluationTitle%></b></h4></div>
                    <div class="col-sm-6"><h4 class="box-title" style="text-align: right;padding-right: 35px;"><b>单项得分：</b><span class="oneSum red">0</span> 分</h4></div>
                </div>
                <!-- /.box-header -->
                <div class="col-sm-12">
                        <div class="col-sm-12 heard">
                            <div class="col-sm-1 ">考核要点</div>
                            <div class="col-sm-1 ">分值</div>
                            <div class="col-sm-10">
                                <div class="col-sm-12 cell" style="padding: 0;border: 0;">
                                    <div class="col-sm-2 ">要点分类</div>
                                    <div class="col-sm-1 ">分值</div>
                                    <div class="col-sm-5 ">评分标准</div>
                                    <div class="col-sm-2 ">扣分原因</div>
                                    <div class="col-sm-1 ">得分</div>
                                    <div class="col-sm-1 ">考核依据</div>
                                </div>
                            </div>

                        </div>
                        <% for(var j = 0; j < evaluation.indicators.length; j++) { %>
                        <% var indicator = evaluation.indicators[j] %>
                        <div class="col-sm-12 row-cell">
                            <div class="col-sm-1 cell"><div class="npmal"><%=indicator.points%></div></div>
                            <div class="col-sm-1 cell"><div class="npmal"><%=indicator.score%></div></div>
                            <div class="col-sm-10">
                                <% for(var o = 0; o < indicator.scaleMarks.length; o++) { %>
                                <% var scaleMarkNode = indicator.scaleMarks[o] %>
                                <div class="col-sm-12 cell" style="padding: 0;border: 0;">
                                    <div class="col-sm-2 cell">
                                        <div class="npmal"><%=scaleMarkNode.node3title%></div>
                                    </div>
                                    <div class="col-sm-1 cell">
                                        <div class="npmal"><%=scaleMarkNode.node3score%></div>
                                    </div>
                                    <div class="col-sm-5 cell" style="justify-content:left;">
                                        <div class="scaleMark">
                                            <% for(var k = 0; k < scaleMarkNode.questions.length; k++) { %>
                                            <% var scaleMark = scaleMarkNode.questions[k] %>
                                            <div ><%=scaleMark.scaleMarkTitle%></div>
                                            <%} %>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 cell"><textarea class="textarea" placeholder="输入扣分原因"></textarea></div>
                                    <div class="col-sm-1 cell">
                                        <div class="npmal">
                                            <input data-score="<%=scaleMarkNode.node3score%>" class="form-control"style="margin: 0px 5px;" name="grade" placeholder="请输入得分值" title="请输入得分值">
                                        </div>
                                    </div>
                                    <div class="col-sm-1 cell"><div class="npmal">
                                        <a class="openFram" href="javascript:void (0)"><%=scaleMark.gist.title%></a></div>
                                    </div>
                                </div>

                                <%} %>
                            </div>
                            </div>
                        <%}%>
                </div>
                <!-- /.box-body -->
            </div>
    </li>
    <% }%>
</ul>
<div id="open" style="display: none;">
    <div style="text-align: center;vertical-align: center;">
        <img src="modules/evaluation/u469.png">
    </div>
</div>
<script>
    $(window).resize(function () {
        fitHeight()
    })
    fitHeight()

    $(".openFram").on("click",function () {
        var title = $(this).text();
        layer.open({
            type: 1,
            title:title,
            area: ['500px', '500px'],
            content: $('#open') //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
        });
    })

    function fitHeight() {
        $("#center").height($("body").height() - 250)
    }
    /**计分**/
    $("[name='grade']").on("change",function () {
        var $this = $(this);
        var one = $this.val() || 0;
        var max = $(this).data("score");
        if (!parseFloat(one)){
            layer.msg("请输入数值！")
            $this.val("");
        }
        if (one>max){
            layer.msg("分值超标！")
            $this.val("");
        }
        //组分
        var $group = $this.parents(".group")
        var oneSum = 0;
        $group.find("[name='grade']").each(function () {
            var v = $(this).val()||0;
            oneSum = oneSum+v*1;
        })
        $group.find(".oneSum").text(oneSum);
        //总分
        sumGrade();
    })
    function sumGrade() {
        var sum = 0;
        $("[name='grade']").each(function () {
            var one = $(this).val() || 0;
            sum += one*1;
        })
        if (sum < 0) {
            sum = 0;
        }
        $("#sum").val(sum);
        $("#sumSpan").text(sum);
    }
    /********* 计 分end *********/
</script>
